<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Firebase ID Token Helper</title>
    <style>
      body { font-family: system-ui, sans-serif; max-width: 640px; margin: 40px auto; }
      input { width: 100%; padding: 8px; margin: 8px 0; }
      button { padding: 10px 16px; }
      pre { background: #f5f5f5; padding: 12px; white-space: pre-wrap; }
    </style>
  </head>
  <body>
    <h1>Get Firebase ID Token (Phone Auth)</h1>
    <p>Use a Test phone number and code you configured in Firebase Console.</p>

    <label>Phone number (E.164, e.g. +23470107200069)</label>
    <input id="phone" placeholder="+234 701 072 0069" value="+2347010720069" />

    <!-- Add a container for reCAPTCHA (invisible) -->
    <div id="recaptcha-container" style="min-height:24px;"></div>

    <label>Test code (e.g. 123456)</label>
    <input id="code" placeholder="112233" />

    <button id="send">Sign In and Get ID Token</button>

    <h3>ID Token</h3>
    <pre id="out"></pre>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
      import { getAuth, signInWithPhoneNumber, RecaptchaVerifier } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";

      // Replace with your project's Firebase config from Firebase Console
      const firebaseConfig = {
        apiKey: "AIzaSyBz-lXlS6cQAygl0aLzu0RIT_n1KusE_xI",
        authDomain: "umoja-auth.firebaseapp.com",
        projectId: "umoja-auth",
        storageBucket: "umoja-auth.firebasestorage.app",
        messagingSenderId: "258073848802",
        appId: "1:258073848802:web:ad9a14ecebc8d6830927bb",
      };

      
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      // For test phone numbers only; remove/disable for real phones in production
      auth.settings.appVerificationDisabledForTesting = true;

      const phoneInput = document.getElementById('phone');
      const codeInput = document.getElementById('code');
      const out = document.getElementById('out');

      function log(msg) {
        out.textContent = msg;
        console.log(msg);
      }

      // Initialize and render invisible reCAPTCHA
      let recaptcha;
      try {
        recaptcha = new RecaptchaVerifier(auth, 'recaptcha-container', { size: 'invisible' });
        await recaptcha.render();
        log('reCAPTCHA ready.');
      } catch (e) {
        log('Error initializing reCAPTCHA: ' + (e?.message || e));
      }

      document.getElementById('send').onclick = async () => {
        try {
          const raw = phoneInput.value.trim();
          const compact = raw.replace(/\s+/g, '');
          const phone = compact.startsWith('+') ? compact : `+${compact}`;
          const code = codeInput.value.trim();
          if (!phone) return log('Enter phone number in E.164 format, e.g., +2347010720069');
          if (!code) return log('Enter the test verification code from Firebase Console.');

          log('Sending code...');
          const confirmation = await signInWithPhoneNumber(auth, phone, recaptcha);
          log('Code sent. Confirming...');
          const credential = await confirmation.confirm(code);
          log('Confirmed. Getting IdToken...');
          const idToken = await credential.user.getIdToken(true);
          out.textContent = idToken;
          console.log('IdToken:', idToken);
          log('Success. Token shown above.');
        } catch (e) {
          log('Error: ' + (e?.message || e));
          console.error(e);
        }
      };
    </script>
  </body>
</html>